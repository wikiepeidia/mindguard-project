{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-6">
    <div class="card shadow-sm border-0 rounded-4 text-center glass-card">
      <div class="card-body p-5">
        
        <h3 class="fw-bold mb-4 text-white">Kết Quả Bài Test</h3>
        
        {% if score is not none %}
          <div class="mb-4">
              <!-- Vòng tròn điểm số -->
              <div class="d-inline-flex justify-content-center align-items-center rounded-circle border border-4 border-{{ 'success' if score/max_score >= 0.75 else 'warning' }} p-5 mb-3" style="width: 150px; height: 150px;">
                  <div>
                      <span class="display-4 fw-bold text-white">{{ score }}</span>
                      <span class="text-muted fs-5">/{{ max_score }}</span>
                  </div>
              </div>
          </div>

          {% if max_score and score / max_score >= 0.75 %}
            <h4 class="text-success fw-bold mb-3">Đạt Yêu Cầu!</h4>
            <p class="text-white-50">Chúc mừng bạn đã có đủ kiến thức nền tảng về an toàn mạng.</p>
            
            {% if session.get('certificate_code') %}
            <div class="alert alert-success bg-opacity-10 border-success d-inline-block text-start mt-2">
                <i class="fas fa-certificate me-2"></i> Mã chứng nhận: <strong>{{ session.get('certificate_code') }}</strong>
            </div>
            {% endif %}
          
          {% else %}
            <h4 class="text-warning fw-bold mb-3">Cần Cố Gắng Thêm</h4>
            <p class="text-white-50">Bạn cần đạt ít nhất 75% số điểm để nhận chứng nhận MindGuard.</p>
            <p class="small text-muted">Gợi ý: Hãy đọc kỹ các cảnh báo trên trang chủ và thử lại.</p>
          {% endif %}

        {% else %}
          <p class="text-muted">Chưa có dữ liệu bài test. Vui lòng làm bài test trước.</p>
        {% endif %}

        <hr class="border-secondary opacity-25 my-4">

        <div class="d-flex justify-content-center gap-3">
          <!-- NÚT LÀM LẠI: Thêm tham số force='true' -->
          <a href="{{ url_for('quiz.quiz', force='true') }}" class="btn btn-primary px-4 py-2 rounded-pill fw-bold">
            <i class="fas fa-redo-alt me-2"></i> Làm lại bài test
          </a>
          
          <!-- Nút về trang chủ -->
          <a href="{{ url_for('main.index') }}" class="btn btn-outline-light px-4 py-2 rounded-pill">
            <i class="fas fa-home me-2"></i> Về trang chủ
          </a>
        </div>
        
        {% if session.get('certificate_code') %}
        <div class="mt-4">
            <a href="{{ url_for('quiz.certificate') }}" class="text-info text-decoration-none small hover-link">
                Xem chi tiết chứng nhận <i class="fas fa-arrow-right ms-1"></i>
            </a>
        </div>
        {% endif %}

      </div>
    </div>
  </div>
</div>
{% endblock %}