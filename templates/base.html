<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MindGuard - An ninh m·∫°ng c·ªông ƒë·ªìng{% endblock %}</title>

    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Custom Base CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
</head>

<body>

    <canvas id="network-canvas"></canvas>

    <nav class="navbar navbar-expand-lg fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('main.index') }}">
                <i class="fas fa-shield-alt text-info me-2"></i>Mind<span>Guard</span>
            </a>
            <button class="navbar-toggler border-0 shadow-none" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarNav">
                <i class="fas fa-bars text-white"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">

                    {% if session.get('is_admin') %}
                    <li class="nav-item">
                        <span class="badge bg-danger bg-opacity-10 text-danger border border-danger p-2 me-3">
                            <i class="fas fa-user-secret me-1"></i> ADMIN ACCESS
                        </span>
                    </li>
                    <li class="nav-item"><a class="btn btn-info btn-sm fw-bold px-3 rounded-pill text-dark"
                            href="{{ url_for('admin.admin_dashboard') }}">Dashboard</a></li>
                    <li class="nav-item ms-2"><a class="btn btn-outline-light btn-sm rounded-pill px-3"
                            href="{{ url_for('admin.admin_logout') }}">Tho√°t</a></li>

                    {% elif session.get('registration_email') %}
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.index') }}">Trang ch·ªß</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('quiz.quiz') }}">Test IQ</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('scammer.report_scammer') }}">T·ªë c√°o</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.leaderboard') }}">S·ªï ƒëen</a></li>
                    <li class="nav-item"><a class="nav-link text-info fw-bold" href="#"
                            onclick="document.body.classList.toggle('show-chatbot'); return false;">AI Chat</a></li>

                    <li class="nav-item dropdown ms-3">
                        <a class="nav-link dropdown-toggle btn btn-outline-light rounded-pill px-4 py-1 text-white border-opacity-25"
                            href="#" data-bs-toggle="dropdown">
                            {{ session.get('registration_name') }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end shadow-lg border-0 bg-dark mt-2 p-2">
                            <li><a class="dropdown-item rounded text-white" href="{{ url_for('auth.profile') }}"><i
                                        class="fas fa-id-card me-2 text-info"></i> H·ªì s∆°</a></li>
                            <li>
                                <hr class="dropdown-divider bg-secondary opacity-25">
                            </li>
                            <li><a class="dropdown-item rounded text-danger" href="{{ url_for('auth.logout') }}"><i
                                        class="fas fa-power-off me-2"></i> ƒêƒÉng xu·∫•t</a></li>
                        </ul>
                    </li>
                    {% else %}
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('main.leaderboard') }}">C·∫£nh b√°o</a></li>
                    <li class="nav-item ms-2"><a class="nav-link fw-bold text-white"
                            href="{{ url_for('auth.login') }}">ƒêƒÉng nh·∫≠p</a></li>
                    <li class="nav-item ms-3"><a class="btn btn-info fw-bold px-4 rounded-pill text-dark shadow-sm"
                            href="{{ url_for('auth.register') }}">Tham gia ngay</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div style="height: 80px;"></div>

    <div class="container mt-3" style="position: absolute; top: 90px; right: 20px; z-index: 9999; max-width: 400px;">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show shadow glass-card p-3 mb-2 text-white"
            role="alert">
            <i class="fas fa-info-circle me-2 text-info"></i> {{ message }}
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    {% block content %}{% endblock %}

    <!-- Chatbot Widget: Always available (Anonymous or Logged In) -->
    <button class="chatbot-toggler d-flex align-items-center justify-content-center"
        onclick="document.body.classList.toggle('show-chatbot')">
        <span class="icon-chat position-absolute d-flex align-items-center justify-content-center w-100 h-100"><i
                class="fas fa-robot fa-lg text-white"></i></span>
        <span class="icon-close position-absolute d-flex align-items-center justify-content-center w-100 h-100"
            style="opacity: 0;"><i class="fas fa-times fa-lg text-white"></i></span>
    </button>

    <div class="chatbot-window">
        <div class="chat-header text-white">
            <div class="d-flex align-items-center">
                <i class="fas fa-robot me-2 fs-4"></i>
                <div>
                    <h5 class="mb-0">MindGuard AI</h5>
                    <small class="opacity-75" style="font-size: 0.7rem;">Online 24/7 ‚Ä¢ Chuy√™n gia b·∫£o m·∫≠t</small>
                </div>
            </div>
            <i class="fas fa-times fs-5" style="cursor: pointer;"
                onclick="document.body.classList.remove('show-chatbot')"></i>
        </div>
        <div class="chatbox" id="chatbox">
            <div class="chat-msg msg-incoming">
                üëã Xin ch√†o! T√¥i l√† AI ph√¢n t√≠ch l·ª´a ƒë·∫£o. B·∫°n h√£y copy tin nh·∫Øn ho·∫∑c ƒë∆∞·ªùng link nghi ng·ªù v√†o ƒë√¢y ƒë·ªÉ t√¥i
                ki·ªÉm tra nh√©!
            </div>
        </div>
        <div class="chat-input">
            <textarea id="chatInput" placeholder="Nh·∫≠p n·ªôi dung c·∫ßn ki·ªÉm tra..." required></textarea>
            <button id="sendChatBtn" class="send-btn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <footer class="mt-auto border-top border-white border-opacity-10 bg-black bg-opacity-20 pt-5 pb-4">
        <div class="container">
            <div class="row g-4 mb-4">
                <div class="col-lg-5">
                    <a class="navbar-brand d-block mb-3" href="{{ url_for('main.index') }}">
                        <i class="fas fa-shield-alt text-info me-2"></i>Mind<span>Guard</span>
                    </a>
                    <p class="text-slate-400 small mb-3">
                        H·ªá th·ªëng c·∫£nh b√°o v√† ph√≤ng ch·ªëng l·ª´a ƒë·∫£o tr·ª±c tuy·∫øn d·ª±a tr√™n s·ª©c m·∫°nh c·ªông ƒë·ªìng v√† tr√≠ tu·ªá nh√¢n
                        t·∫°o.
                    </p>
                    <div class="d-flex gap-2">
                        <a href="https://github.com/wikiepeidia/mindguard-project" target="_blank"
                            class="btn btn-outline-light btn-sm rounded-circle border-opacity-25"
                            style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;"
                            title="View Source Code"><i class="fab fa-github"></i></a>
                    </div>
                </div>
                <div class="col-lg-3 col-6">
                    <h6 class="text-white fw-bold mb-3">Li√™n k·∫øt</h6>
                    <ul class="list-unstyled small">
                        <li class="mb-2"><a href="{{ url_for('main.index') }}"
                                class="text-slate-400 text-decoration-none hover:text-info">Trang ch·ªß</a></li>
                        <li class="mb-2"><a href="{{ url_for('scammer.report_scammer') }}"
                                class="text-slate-400 text-decoration-none hover:text-info">T·ªë c√°o</a></li>
                        <li class="mb-2"><a href="{{ url_for('main.leaderboard') }}"
                                class="text-slate-400 text-decoration-none hover:text-info">C·∫£nh b√°o</a></li>
                        <li class="mb-2"><a href="{{ url_for('quiz.quiz') }}"
                                class="text-slate-400 text-decoration-none hover:text-info">Ki·ªÉm tra IQ</a></li>
                    </ul>
                </div>
                <div class="col-lg-4">
                    <h6 class="text-white fw-bold mb-3">ƒêƒÉng k√Ω nh·∫≠n tin</h6>
                    <p class="text-slate-400 small mb-3">Nh·∫≠n c·∫£nh b√°o m·ªõi nh·∫•t qua email.</p>
                    <div class="input-group">
                        <input type="email" class="form-control bg-dark border-secondary text-white"
                            placeholder="Email c·ªßa b·∫°n">
                        <button class="btn btn-info text-white" type="button"><i
                                class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
            <div class="text-center border-top border-white border-opacity-10 pt-4">
                <p class="text-secondary small mb-0">&copy; 2025 MindGuard Community Project. <span
                        class="text-slate-400">B·∫£o m·∫≠t & Minh b·∫°ch.</span></p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        window.CHATBOT_API_URL = "{{ url_for('chatbot.chatbot_api') }}";
    </script>
    <script src="{{ url_for('static', filename='js/base.js') }}"></script>
</body>

</html>